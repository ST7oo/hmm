import numpy as np
import timeit
from HMM import HMM

states = ['INIT', 'Onset', 'Mid', 'End', 'FINAL']
observations = ['C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7']
A = [[0, 1, 0, 0, 0],
     [0, 0.3, 0.7, 0, 0],
     [0, 0, 0.9, 0.1, 0],
     [0, 0, 0, 0.4, 0.6],
     [0, 0, 0, 0, 0]]
B = [[0, 0, 0, 0, 0, 0, 0],
     [0.5, 0.2, 0.3, 0, 0, 0, 0],
     [0, 0, 0.2, 0.7, 0.1, 0, 0],
     [0, 0, 0, 0.1, 0, 0.5, 0.4],
     [0, 0, 0, 0, 0, 0, 0]]
A_ini = [[0, 1, 0, 0, 0],
         [0, 0.5, 0.5, 0, 0],
         [0, 0, 0.5, 0.5, 0],
         [0, 0, 0, 0.5, 0.5],
         [0, 0, 0, 0, 0]]
B_ini = [[0, 0, 0, 0, 0, 0, 0],
         [0.33, 0.33, 0.33, 0, 0, 0, 0],
         [0, 0, 0.33, 0.33, 0.33, 0, 0],
         [0, 0, 0, 0.33, 0, 0.33, 0.33],
         [0, 0, 0, 0, 0, 0, 0]]
seq = [['C1', 'C2', 'C3', 'C4', 'C4', 'C6', 'C7'],
       ['C2', 'C2', 'C5', 'C4', 'C4', 'C6', 'C6']]
seq1 = [['C1', 'C2', 'C3', 'C4', 'C4', 'C6', 'C7'],
        ['C2', 'C2', 'C5', 'C4', 'C4', 'C6', 'C6'],
        ['C1', 'C2', 'C3', 'C6']]
seq_train = [['C1', 'C4', 'C6', 'C7', 'C6'],
             ['C1', 'C5', 'C7'],
             ['C2', 'C1', 'C3', 'C1', 'C1', 'C4', 'C4', 'C4', 'C4', 'C5', 'C4', 'C4', 'C4',
              'C4', 'C5', 'C5', 'C3', 'C4', 'C4', 'C3', 'C3', 'C5', 'C7', 'C6', 'C7'],
             ['C2', 'C1', 'C5', 'C4', 'C4', 'C4', 'C4',
              'C4', 'C4', 'C4', 'C5', 'C4', 'C4', 'C6'],
             ['C3', 'C4', 'C7', 'C7'],
             ['C2', 'C3', 'C4', 'C3', 'C4', 'C3', 'C6', 'C6'],
             ['C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C5', 'C4', 'C4',
              'C4', 'C5', 'C4', 'C3', 'C3', 'C4', 'C4', 'C4', 'C3', 'C6'],
             ['C3', 'C3', 'C1', 'C4', 'C3', 'C5',
              'C4', 'C4', 'C4', 'C4', 'C4', 'C6'],
             ['C2', 'C3', 'C5', 'C4', 'C7'],
             ['C2', 'C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C6'],
             ['C1', 'C4', 'C6', 'C7'],
             ['C1', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C5', 'C4',
              'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C4', 'C5', 'C4', 'C3', 'C5', 'C7'],
             ['C2', 'C4', 'C7'],
             ['C3', 'C4', 'C7'],
             ['C2', 'C1', 'C4', 'C4', 'C4', 'C4', 'C3',
              'C4', 'C4', 'C4', 'C3', 'C4', 'C5', 'C7'],
             ['C1', 'C4', 'C4', 'C3', 'C3', 'C4', 'C4', 'C4', 'C6', 'C7'],
             ['C1', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C6'],
             ['C1', 'C3', 'C4', 'C4', 'C3', 'C5', 'C4', 'C4', 'C3', 'C4', 'C4', 'C3', 'C4', 'C4', 'C3', 'C4', 'C4',
              'C4', 'C4', 'C4', 'C4', 'C4', 'C3',
              'C5', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4',
              'C4', 'C4', 'C4', 'C4', 'C7'],
             ['C1', 'C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4',
              'C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C6', 'C7'],
             ['C3', 'C4', 'C6'],
             ['C2', 'C4', 'C4', 'C5', 'C6'],
             ['C2', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4',
              'C3', 'C4', 'C4', 'C4', 'C3', 'C4', 'C3', 'C4', 'C4', 'C4', 'C4', 'C7'],
             ['C1', 'C5', 'C4', 'C4', 'C7'],
             ['C1', 'C4', 'C5', 'C4', 'C6'],
             ['C3', 'C4', 'C5', 'C4', 'C4', 'C3', 'C4', 'C5', 'C4', 'C3', 'C3', 'C4', 'C4', 'C4',
              'C4', 'C4', 'C5', 'C4', 'C5', 'C4', 'C4', 'C5', 'C4', 'C4', 'C4', 'C4', 'C6'],
             ['C3', 'C3', 'C3', 'C4', 'C3', 'C5', 'C3', 'C4',
              'C5', 'C4', 'C4', 'C4', 'C4', 'C6', 'C4'],
             ['C3', 'C5', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C6'],
             ['C3', 'C2', 'C1', 'C1', 'C2', 'C3', 'C3', 'C6', 'C6', 'C6'],
             ['C3', 'C4', 'C4', 'C4', 'C3', 'C6', 'C6'],
             ['C2', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C5',
              'C4', 'C3', 'C3', 'C4', 'C4', 'C4', 'C3', 'C5', 'C3', 'C4', 'C3', 'C7', 'C6'],
             ['C1', 'C4', 'C5', 'C4', 'C6', 'C6'],
             ['C3', 'C1', 'C4', 'C5', 'C4', 'C4', 'C4', 'C4',
              'C3', 'C3', 'C3', 'C4', 'C4', 'C4', 'C7', 'C4'],
             ['C1', 'C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C7', 'C4'],
             ['C3', 'C1', 'C4', 'C4', 'C4', 'C5', 'C4', 'C4', 'C4', 'C4', 'C7'],
             ['C2', 'C4', 'C4', 'C3', 'C4', 'C3', 'C4', 'C4', 'C4', 'C3', 'C3', 'C4', 'C4', 'C5', 'C4', 'C5', 'C4',
              'C4',
              'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C3', 'C3', 'C4', 'C4', 'C3', 'C4', 'C3', 'C4', 'C4', 'C4', 'C3',
              'C6'],
             ['C1', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C6'],
             ['C2', 'C1', 'C4', 'C4', 'C5', 'C4', 'C4', 'C4', 'C3', 'C3', 'C4', 'C4', 'C4', 'C4', 'C3', 'C3', 'C4',
              'C4', 'C4',
              'C4', 'C3', 'C4', 'C5', 'C4', 'C4', 'C4', 'C4', 'C3', 'C3', 'C5', 'C4', 'C4', 'C4', 'C4', 'C5', 'C4',
              'C4'],
             ['C1', 'C3', 'C4', 'C3', 'C4', 'C4', 'C4', 'C4', 'C3', 'C6', 'C6'],
             ['C1', 'C4', 'C5', 'C4'],
             ['C2', 'C1', 'C2', 'C3', 'C3', 'C4', 'C4', 'C5', 'C4', 'C3', 'C6'],
             ['C1', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C5', 'C4', 'C4',
              'C4', 'C3', 'C4', 'C4', 'C5', 'C5', 'C3', 'C4', 'C7', 'C7'],
             ['C2', 'C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C3', 'C4', 'C4',
              'C4', 'C4', 'C4', 'C4', 'C3', 'C5', 'C4', 'C4', 'C4', 'C4', 'C4', 'C5', 'C4', 'C7', 'C6', 'C7'],
             ['C2', 'C3', 'C6'],
             ['C3', 'C5', 'C4', 'C4', 'C4', 'C4', 'C4',
              'C3', 'C4', 'C6', 'C6', 'C4', 'C7'],
             ['C2', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C3', 'C4', 'C7'],
             ['C3', 'C1', 'C1', 'C1', 'C2', 'C4', 'C4', 'C4',
              'C3', 'C4', 'C4', 'C6', 'C6', 'C6', 'C4', 'C7'],
             ['C3', 'C2', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C3', 'C5', 'C4', 'C5', 'C3', 'C4',
              'C4', 'C4', 'C5', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4', 'C3', 'C3', 'C6', 'C4'],
             ['C1', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C5', 'C4', 'C4', 'C5', 'C4', 'C4',
              'C3', 'C4', 'C3', 'C4', 'C3', 'C4', 'C3', 'C4', 'C3', 'C4', 'C7', 'C7', 'C7'],
             ['C1', 'C4', 'C4', 'C5', 'C4', 'C4', 'C4',
              'C4', 'C4', 'C5', 'C6', 'C6', 'C6'],
             ['C2', 'C4', 'C4', 'C4', 'C6', 'C7'],
             ['C3', 'C4', 'C4', 'C3', 'C4', 'C3', 'C4', 'C4', 'C4',
              'C4', 'C3', 'C4', 'C4', 'C4', 'C4', 'C7', 'C7', 'C6'],
             ['C3', 'C4', 'C4', 'C3', 'C4', 'C4', 'C5', 'C4', 'C4', 'C4', 'C7'],
             ['C3', 'C4', 'C4', 'C6', 'C7'],
             ['C1', 'C4', 'C4', 'C4', 'C7', 'C6'],
             ['C3', 'C1', 'C3', 'C3', 'C4', 'C4', 'C4', 'C6'],
             ['C3', 'C1', 'C4', 'C3', 'C4', 'C4',
              'C4', 'C4', 'C4', 'C3', 'C4', 'C6'],
             ['C3', 'C1', 'C1', 'C1', 'C1', 'C3', 'C7', 'C6'],
             ['C1', 'C4', 'C6', 'C6'],
             ['C3', 'C4', 'C3', 'C4', 'C4', 'C4', 'C3', 'C3', 'C3', 'C6'],
             ['C1', 'C3', 'C5', 'C5', 'C4', 'C3', 'C4', 'C4', 'C4', 'C7'],
             ['C3', 'C3', 'C7', 'C7'],
             ['C1', 'C3', 'C3', 'C4', 'C3', 'C5',
              'C5', 'C3', 'C4', 'C3', 'C4', 'C6'],
             ['C1', 'C3', 'C6', 'C6'],
             ['C1', 'C4', 'C5', 'C4', 'C4', 'C6', 'C6'],
             ['C2', 'C1', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C3', 'C4'],
             ['C3', 'C5', 'C4', 'C3', 'C3', 'C4', 'C4',
              'C4', 'C3', 'C4', 'C5', 'C4', 'C7'],
             ['C3', 'C4', 'C4', 'C4', 'C5', 'C4', 'C4', 'C4', 'C4', 'C4',
              'C4', 'C4', 'C3', 'C4', 'C4', 'C3', 'C4', 'C7', 'C7'],
             ['C2', 'C1', 'C3', 'C3', 'C4', 'C3', 'C4',
              'C3', 'C4', 'C4', 'C4', 'C4', 'C6'],
             ['C2', 'C1', 'C4', 'C5', 'C4', 'C4', 'C7', 'C4', 'C6', 'C6'],
             ['C1', 'C1', 'C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C7'],
             ['C3', 'C1', 'C4', 'C5', 'C4', 'C6'],
             ['C1', 'C3', 'C4', 'C3', 'C5', 'C4', 'C3', 'C4',
              'C4', 'C4', 'C4', 'C3', 'C6', 'C6', 'C6'],
             ['C2', 'C1', 'C3', 'C1', 'C1', 'C3', 'C4', 'C4', 'C4', 'C6', 'C6'],
             ['C1', 'C2', 'C3', 'C5', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3',
              'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C7', 'C6'],
             ['C3', 'C3', 'C4', 'C4', 'C6'],
             ['C1', 'C4', 'C4', 'C4', 'C5', 'C3', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C3', 'C4', 'C3', 'C4',
              'C4', 'C3', 'C4', 'C3', 'C4',
              'C3', 'C4', 'C4', 'C4', 'C4', 'C5', 'C3', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4', 'C3', 'C4', 'C3', 'C4',
              'C4', 'C4', 'C4', 'C6'],
             ['C1', 'C3', 'C4', 'C4', 'C6', 'C6', 'C7'],
             ['C2', 'C3', 'C4', 'C4', 'C4', 'C4', 'C7'],
             ['C1', 'C3', 'C4', 'C4', 'C6', 'C6'],
             ['C1', 'C3', 'C3', 'C4', 'C3', 'C3', 'C4', 'C4', 'C4', 'C4', 'C5', 'C4',
              'C4', 'C5', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C3', 'C3', 'C7'],
             ['C2', 'C1', 'C4', 'C3', 'C3', 'C4', 'C3', 'C4', 'C4', 'C4',
              'C3', 'C4', 'C4', 'C3', 'C4', 'C5', 'C4', 'C5', 'C6', 'C7'],
             ['C1', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4',
              'C4', 'C4', 'C3', 'C3', 'C5', 'C5', 'C5', 'C4', 'C3', 'C4', 'C4', 'C4', 'C3', 'C7'],
             ['C1', 'C4', 'C4', 'C4', 'C5', 'C4', 'C4',
              'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C7'],
             ['C2', 'C4', 'C5', 'C4', 'C4', 'C4', 'C4', 'C4', 'C3', 'C4',
              'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C7', 'C6'],
             ['C2', 'C4', 'C3', 'C5', 'C4', 'C3', 'C4', 'C4', 'C4', 'C3', 'C4', 'C4',
              'C4', 'C4', 'C4', 'C4', 'C4', 'C5', 'C5', 'C4', 'C3', 'C3', 'C3', 'C6'],
             ['C1', 'C4', 'C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4',
              'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C6', 'C6'],
             ['C3', 'C3', 'C4', 'C4', 'C4', 'C4',
              'C5', 'C4', 'C4', 'C4', 'C5', 'C7'],
             ['C3', 'C4', 'C4'],
             ['C1', 'C4', 'C4', 'C7'],
             ['C1', 'C3', 'C4', 'C5', 'C3', 'C4', 'C7', 'C6'],
             ['C3', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C7', 'C4', 'C7'],
             ['C1', 'C3', 'C4', 'C4'],
             ['C3', 'C3', 'C4', 'C4', 'C4', 'C4', 'C6'],
             ['C3', 'C3', 'C5', 'C4', 'C5', 'C4'],
             ['C1', 'C1', 'C4', 'C4', 'C3', 'C4', 'C4', 'C4', 'C4', 'C4',
              'C4', 'C4', 'C3', 'C4', 'C6', 'C7', 'C6', 'C6', 'C7'],
             ['C3', 'C3', 'C3', 'C4', 'C4', 'C7', 'C6'],
             ['C3', 'C1', 'C3', 'C4', 'C4', 'C3', 'C3', 'C6'],
             ['C2', 'C3', 'C3', 'C4', 'C4', 'C5', 'C6', 'C7'],
             ['C2', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4', 'C4',
              'C4', 'C4', 'C4', 'C3', 'C4', 'C4', 'C3', 'C7'],
             ['C1', 'C3', 'C2', 'C4', 'C4', 'C6', 'C7', 'C7']]
h = HMM(A, B, states, observations)
# print(h.gen_sequence(3))
print(h.viterbi(seq))
# print(h.forward(seq))
# h1 = HMM(A_ini, B_ini, states, observations)
# epochs = h1.baum_welch(seq_train)
# print('epochs', epochs)
# print('A', h1.A)
# print('B', h1.B)
# print(h1.A.sum(1))
# print(h1.B.sum(1))
# t = timeit.Timer(lambda: HMM(A_ini, B_ini, states, observations).baum_welch(seq_train))
# t = timeit.Timer(lambda: HMM(A_ini, B_ini, states, observations).forward(seq[0]))
# print(t.timeit(number=100))
# 21.494664558002114
# 20.40747640599875
# 20.855567466001958
# 20.431506337001338
